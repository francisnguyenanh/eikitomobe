<!-- card_view.html: Không kế thừa base.html, chỉ hiển thị card đơn giản cho người xem link chia sẻ -->
<div class="container py-4" style="max-width:700px;margin:auto;">
  <div class="row justify-content-center">
    <div class="col-12">
      <div id="cardPreview" class="card-preview-view" style="background: {{ card.bgColor or '#fff' }}; min-height: 420px; border-radius: 1.5rem; box-shadow: 0 4px 32px rgba(0,0,0,0.10); position: relative; overflow: hidden;">
        <!-- Hiệu ứng động canvas -->
        <canvas id="cardEffectCanvas" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;"></canvas>
        <div class="card-content-view p-4" style="position:relative;z-index:2;">
          <div class="d-flex align-items-center mb-3">
            {% if card.avatar_url %}
              <img src="{{ card.avatar_url }}" alt="avatar" class="rounded-circle me-3" style="width:56px;height:56px;object-fit:cover;">
            {% endif %}
            <div>
              <h4 class="mb-0">{{ card.name or 'Tên người nhận' }}</h4>
              <div class="text-muted small">{{ card.eventLabel or 'Loại kỷ niệm' }}{% if card.eventDate %} • {{ card.eventDate }}{% endif %}</div>
            </div>
          </div>
          <div class="mb-3">
            <div class="fw-bold" style="font-size:1.1rem;">Lời chúc:</div>
            <div style="white-space:pre-line;">{{ card.message or 'Chúc mừng kỷ niệm! Chúc bạn luôn hạnh phúc và thành công.' }}</div>
          </div>
          {% if card.specialWish %}
          <div class="mb-2">
            <span class="badge bg-warning text-dark px-3 py-2" style="font-size:1rem;">{{ card.specialWish }}</span>
          </div>
          {% endif %}
          <div class="mt-4 text-end">
            <span class="badge bg-light text-secondary">Mẫu: {{ card.template or 'classic' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
// --- Random hiệu ứng động khi xem card ---
function randomEffect() {
  const effects = ['firework', 'sakura', 'rain', 'sunny'];
  return effects[Math.floor(Math.random()*effects.length)];
}
function startCardEffect(effect) {
  const canvas = document.getElementById('cardEffectCanvas');
  if (!canvas) return;
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  // Simple demo: sakura rơi
  if (effect === 'sakura') {
    let petals = Array.from({length: 18}, () => ({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: 8+Math.random()*8,
      speed: 1+Math.random()*1.5,
      drift: -0.5+Math.random()*1
    }));
    const ctx = canvas.getContext('2d');
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (const p of petals) {
        ctx.save();
        ctx.beginPath();
        ctx.ellipse(p.x, p.y, p.r, p.r*0.6, Math.PI/4, 0, 2*Math.PI);
        ctx.fillStyle = 'rgba(255,182,193,0.7)';
        ctx.shadowColor = '#fff';
        ctx.shadowBlur = 6;
        ctx.fill();
        ctx.restore();
        p.x += p.drift;
        p.y += p.speed;
        if (p.y > canvas.height+20) { p.y = -20; p.x = Math.random()*canvas.width; }
        if (p.x < -20) p.x = canvas.width+20;
        if (p.x > canvas.width+20) p.x = -20;
      }
      requestAnimationFrame(draw);
    }
    draw();
  }
  // TODO: Thêm hiệu ứng firework, rain, sunny...
}
document.addEventListener('DOMContentLoaded', function() {
  const effect = randomEffect();
  startCardEffect(effect);
});
</script>
<style>
.card-preview-view { transition: background 0.3s; }
.card-content-view { min-height: 320px; }
body { background: #f8fafc; }
</style>
